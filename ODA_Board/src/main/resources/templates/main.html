<!DOCTYPE html>
<html lang="en" xmlns:th="www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor-viewer.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
  <th:block th:replace="fragments/header::header"></th:block>
  <div layout:fragment="content" class="d-flex flex-column min-vh-100">
      공통 레이아웃
  </div>
  <th:block th:replace="fragments/footer::footer"></th:block>
  <script src="https://kit.fontawesome.com/8b19001b2a.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script></body>
  <script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script>
    const Editor = toastui.Editor;

    const editor = new Editor({
        el: document.querySelector('#editor'),
        height: '700px',
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical',
        placeholder: '내용을 입력해주세요.'
    });


        // 게시글 작성 ajax
        $('#submitBtn').on("click", function () {

            const title = $.trim($('#title').val())
            const content = $.trim(editor.getHTML())
            const contentStr = content.replace(/\s/gi, "")
            // 유효성 검사
            if(title === "" || content === "<p><br></p>" || contentStr === "<p></p>") {
                alert('제목 또는 내용이 비어있습니다.');
            } else {
                $.ajax({
                    type: "POST",
                    url: "/board/writeProc",
                    data: {
                        title: title,
                        content: editor.getHTML(),
                    },
                    success: function (data) {
                        location.replace(data)
                    },
                    error: function (e) {
                        console.log(e)
                    }
                });
            }});
</script>
<script>
    const Viewer = toastui.Editor;

    const viewer = new Viewer.factory({
        el: document.querySelector('#viewer'),
        viewer: true
    })

    const viewerData = $('#viewer').data('content');
    viewer.setMarkdown(viewerData)
</script>
<script th:inline="javascript">
    const Modify = toastui.Editor;

    const modify = new Modify({
        el: document.querySelector('#modify-editor'),
        height: '700px',
        initialEditType: 'wysiwyg',
        previewStyle: 'vertical'
    })

    const modifyData = $('#modify-editor').data('content')

    modify.setHTML(modifyData)

    const bno = $('#bno').data('bno')

    // 게시글 수정 ajax

    $('#modifyBtn').on("click", function() {

        const modifyTitle = $.trim($('#modifyTitle').val())
        const modifyContent = $.trim(modify.getHTML())
        const modifyContentStr = modifyContent.replace(/\s/gi, "")
        // 유효성 검사
        if(modifyTitle === "" || modifyContent === "<p><br></p>" || modifyContentStr === "<p></p>") {
            alert('제목 또는 내용이 비어있습니다.');
        } else {
        $.ajax({
            type: "put",
            url: "/board/modifyProc/" + bno,
            data: {
                title: $('#modifyTitle').val(),
                content: modify.getHTML(),
            },
            success: function(data) {
                location.replace(data)
            },
            error: function(e) {
                console.log(e)
            }
        });
    }});
</script>
</html>